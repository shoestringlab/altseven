var a7;(a7={init:function(e,t,n){var r,i,o;e.model=void 0!==e.model?e.model:"altseven",""===e.model&&n("A model is required, but no model was specified.");let s={auth:{sessionTimeout:e?.auth?.sessionTimeout??9e5},console:e?.console?{enabled:e.console.enabled??!1,wsServer:e.console.wsServer??"",container:e.console.container??("object"==typeof gadgetui?gadgetui.display.FloatingPane:""),top:e.console.top??100,left:e.console.left??500,width:e.console.width??500,height:e.console.height??300}:{},logging:{logLevel:e?.logging?.logLevel??"ERROR,FATAL,INFO",toBrowserConsole:e?.logging?.toBrowserConsole??!1},model:e?.model,remote:e?.remote?{loginURL:e.remote.loginURL??"",logoutURL:e.remote.logoutURL??"",refreshURL:e.remote.refreshURL??"",useTokens:e?.auth?.useTokens??!0,tokenType:e.remote.tokenType??"X-Token"}:{useTokens:!0},router:e?.router?{options:{useEvents:e.router.useEvents??!0},routes:e.router.routes}:void 0,security:e?.security?{enabled:e.security.enabled??!0,options:e.security.options??{}}:{enabled:!0,options:{}},ui:{renderer:e?.ui?.renderer??("object"==typeof Mustache?"Mustache":"object"==typeof Handlebars?"Handlebars":"templateLiterals"),debounceTime:e?.ui?.debounceTime??18,timeout:e?.ui?.timeout??6e5},ready:!1};(r=new Promise(function(e,t){a7.log.trace("a7 - model init"),a7.model.init(s,e,t)})).then(function(){a7.model.set("a7",s)}).then(function(){(i=new Promise(function(e,t){a7.model.get("a7").console.enabled?(a7.log.trace("a7 - console init"),a7.console.init(s,e,t)):e()})).then(function(){a7.log.trace("a7 - log init"),a7.log.init(),s.security.enabled&&(a7.log.trace("a7 - security init"),a7.security.init(s)),a7.log.trace("a7 - remote init"),a7.remote.init(e.remote&&e.remote.modules?e.remote.modules:{}),a7.log.trace("a7 - events init"),a7.events.init(),s.router&&(a7.log.trace("a7 - router init"),a7.router.init(s.router.options,s.router.routes)),new Promise(function(e,t){a7.log.trace("a7 - layout init"),a7.ui.init(e,t)}).then(function(){s.security.enabled?((o=new Promise(function(e,t){a7.log.trace("a7 - isSecured"),a7.security.isAuthenticated(e,t)})).then(function(e){a7.error.init(),a7.log.info("Authenticated: "+e.authenticated+"..."),a7.log.info("Init complete..."),t(e)}),o.catch(function(e){a7.log.error(e),n()})):t({})})}),i.catch(function(e){a7.log.error(e),n()})}),r.catch(function(e){a7.log.error(e),n()})}}).console=(()=>{function i(e,t,n,r){var i=document.createElement("div");i.setAttribute("class","a7-console-row-"+n),void 0!==r&&(i.innerHTML=r+": ",i.setAttribute("class",i.getAttribute("class")+" a7-console-row-"+r)),i.innerHTML+=+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+": "+e,s.appendChild(i)}function o(e,t){var n=0;if("history"===t.type)for(n=0;n<t.data.length;n++)i(t.data[n].text,new Date(t.data[n].time),"websocket");else"message"===t.type?i(t.data.text,new Date(t.data.time),"websocket"):a7.log.error("This doesn't look like valid JSON: ",t)}var s;return{init:function(e,t,n){var r,e=e.console;""===e.container&&n("You must specify a container object for the console display."),e.enabled?((s=document.createElement("div")).setAttribute("id","a7consoleDiv"),s.setAttribute("class","a7-console"),document.body.append(s),(r=a7.components.Constructor(e.container,[s,{width:e.width,left:e.left,height:e.height,title:"Console Window",top:e.top,enableShrink:!0,enableClose:!0}],!1)).element&&r.element.setAttribute("right",0),e.wsServer&&a7.remote.webSocket(e.wsServer,o),a7.console.addMessage=i,a7.log.info("Console initializing..."),t()):n("Console init should not be called when console option is set to false.")}}})(),a7.error=(()=>{var t={};return window.onerror=function(e,t,n,r,i){return a7.error.captureError(e,t,n,r,i),!1},{events:{scriptError:[]},capture:function(){},captureError:function(e,t,n,r,i){var o;-1<e.toLowerCase().indexOf("script error")?a7.log.error("Script Error: See Browser Console for Detail"):(o=["Message: "+e,"URL: "+t,"Line: "+n,"Column: "+r,"Error object: "+JSON.stringify(i)].join(" - "),a7.error.fireEvent("scriptError",[e,t,n,r,i]),a7.log.error(o))},init:function(){a7.components.EventBindings.getAll().forEach(function(e){void 0===t[e]&&(t[e.name]=e.func),a7.error.on=t.on,a7.error.off=t.off,a7.error.fireEvent=t.fireEvent})}}})(),a7.events=(()=>{var r={},i=r.hasOwnProperty;return{subscribe:function(e,t){i.call(r,e)||(r[e]=[]);var n=r[e].push(t)-1;return{remove:function(){delete r[e][n]}}},init:function(){a7.events.subscribe("auth.login",function(e){a7.remote.invoke("auth.login",e)}),a7.events.subscribe("auth.logout",function(e){a7.remote.invoke("auth.logout",e)}),a7.events.subscribe("auth.refresh",function(e){a7.remote.invoke("auth.refresh",e)}),a7.events.subscribe("auth.sessionTimeout",function(){a7.security.invalidateSession()}),a7.events.subscribe("auth.invalidateSession",function(){a7.security.invalidateSession()})},publish:function(e,t){a7.log.trace("event: "+e),i.call(r,e)&&r[e].forEach(function(e){e(t||{})})}}})(),a7.log=(()=>{function t(e,t){n&&0<=s.indexOf(t)||0<=s.indexOf("ALL")?(i&&a7.console.addMessage(e,new Date,"local",t),r&&console.log(e)):n||o.push({message:e,level:t})}var n=!1,r=!1,i=!1,o=[],s="ERROR,FATAL,INFO";return{init:function(){s=a7.model.get("a7").logging.logLevel,r=a7.model.get("a7").logging.toBrowserConsole,i=a7.model.get("a7").console.enabled,n=!0,o.forEach(function(e){t(e.message,e.level)}),a7.log.info("Log initializing...")},error:function(e){t(e,"ERROR")},fatal:function(e){t(e,"FATAL")},info:function(e){t(e,"INFO")},trace:function(e){t(e,"TRACE")},warn:function(e){t(e,"WARN")}}})(),a7.model=(()=>{var n,r={};return{destroy:function(){return r.destroy.apply(n,arguments)},get:function(){return r.get.apply(n,arguments)},set:function(){return r.set.apply(n,arguments)},exists:function(){return r.exists.apply(n,arguments)},bind:function(){return r.bind.apply(n,arguments)},undo:function(){return r.undo.apply(n,arguments)},redo:function(){return r.redo.apply(n,arguments)},rewind:function(){return r.rewind.apply(n,arguments)},fastForward:function(){return r.fastForward.apply(n,arguments)},init:function(e,t){if(a7.log.info("Model initializing... "),"string"==typeof e.model)switch(e.model){case"altseven":(n=a7.components.Model).init(e);break;case"gadgetui":n=gadgetui.model}else"object"==typeof e.model&&(n=e.model);a7.log.trace("Model set: "+n),Object.keys(n).forEach(function(e){r[e]=n[e]}),t()}}})(),a7.components=(()=>{var i={on:function(e,t){return void 0===this.events[e]&&(this.events[e]=[]),this.events[e].push(t),this},off:function(e){return this.events[e]=[],this},fireEvent:function(e,t){var n=this;void 0!==this.events[e]&&this.events[e].forEach(function(e){e(n,t)})},getAll:function(){return[{name:"on",func:this.on},{name:"off",func:this.off},{name:"fireEvent",func:this.fireEvent}]}};class e{constructor(){this.events={}}on(e,t){return void 0===this.events[e]&&(this.events[e]=[]),this.events[e].push(t),this}off(e){return this.events[e]=[],this}fireEvent(e,t){void 0!==this.events[e]&&this.events[e].forEach(e=>{e(this,t)})}getAll(){return[{name:"on",func:this.on},{name:"off",func:this.off},{name:"fireEvent",func:this.fireEvent}]}}class t extends e{#state={};#schema;constructor(e){super(),this.binding=e?.binding,this.#state=e.state,this.#schema=e.schema,this.view=e.view,this.id=this.view.props.id+"-dataProvider",this.services=new Map,this.bindings=new Map,this.config(),this.fireEvent("mustRegister")}config(){this.services=a7.services.getAll(),this.on("mustRegister",()=>{this.register()}),this.bind()}register(){this.services.forEach(e=>{e.registerDataProvider(this)})}bind(){if(this.binding)for(let r in this.binding){var e,t,n,i,o=this.binding[r].dependencies||null,s=[...this.services.values()].find(e=>e.entityClass===this.binding[r].entityClass);s&&(a7.log.trace("Binding: ",r),e=this.binding[r].filter||null,t=this.binding[r].func||null,i=this.binding[r].sort||null,n=this.binding[r].id||null,this.bindings.set(r,{key:r,service:s,filter:e,sort:i,func:t,dependencies:o,id:n}),s.bind(r,e),i=this.getBoundData(this.bindings.get(r)),this.setStateOnly({[r]:i}),s.on("cacheChanged",(e,t)=>{t.state=this.getState(),this.updateBoundState(this.bindings.get(r),t)})),(o=this.binding[r].dependencies||[]).forEach(e=>{let n=e.split(".");1===n.length?this.on("stateChanged",(e,t)=>{a7.log.trace("Binding dependency"),[n]in t&&(a7.log.trace("updated "+n),this.updateBoundState(this.bindings.get(r),{action:"refresh",state:this.getState()}))}):2===n.length&&a7.ui.getView(n[0]).on("stateChanged",(e,t)=>{a7.log.trace("Binding dependency"),[n[1]]in t&&(a7.log.trace("updated "+n[1]),this.updateBoundState(this.bindings.get(r),{action:"refresh",state:this.getState(),dependentState:e.getState()}))})})}}getBoundData(e){let t;var n=this.#schema[e.key].type;return"object"===n?t=e.service.get(e.id):"map"===n&&(t=e.service.get(),null!==e.filter&&(t=e.service.filter(t,e.filter)),null!==e.sort)&&(t=e.service.sort(t,e.sort)),t}async updateBoundState(e,t){let n;null!==e.func?(t=Object.assign(t,{filter:e.filter,sort:e.sort}),n="AsyncFunction"===e.func.constructor.name?await e.func(t):e.func(t),"map"===this.#schema[e.key].type&&Array.isArray(n)&&(n=e.service.convertArrayToMap(n)),this.view.setState({[e.key]:n})):(t=this.getBoundData(e),this.view.setState({[e.key]:t}))}set schema(e){}get schema(){return this.#schema}setStateOnly(e){this.#state=Object.assign(this.#state,e)}setState(e){this.setStateOnly(e),this.fireEvent("stateChanged",e)}getState(){return Object.assign({},this.#state)}}class n extends e{#schema;#data;constructor(e){if(super(),this.#schema=e.schema,this.#data={},this.#schema&&this.validate())for(var[t,n]of Object.entries(this.#schema))this._defineProperty(t),this[t]=e[t]}_defineProperty(r){let i="_"+r;this.#data[i]=void 0,Object.defineProperty(this,r,{get:function(){return this.#data[i]},set:function(e){var t=this.#schema[r];if(t.required&&void 0===e)throw new Error(`Property ${r} is required.`);var t=t.type,n=typeof e;if(!this._isOfType(e,t)&&null!=e)throw new Error(`Invalid type for property ${r}. Expected ${t}, but got ${n}.`);this.#data[i]=e}})}_isOfType(e,t){switch(t){case"date":return new Date(e)instanceof Date;case"array":return Array.isArray(e);case"boolean":return 0===e||1===e||!0===e||!1===e;case"integer":return Number.isInteger(e);case"float":return"number"==typeof e;case"string":return"string"==typeof e;default:return!0}}set schema(e){}get schema(){return this.#schema}validate(){for(var e in this.#schema){if(e.required&&!this.#data[e])throw new Error(`Field ${e} is required`);if(e.type&&typeof this.#data[e]!==e.type)throw new Error(`Field ${e} must be of type `+e.type)}return!0}}var r=(()=>{let s=new Map,r=new Map,t=20;class i{constructor(e,t){this.data=this.processValue(e),this.elements=[],this.mementos=[],this.currentMementoIndex=-1,t&&this.bind(t),this.saveMemento()}handleEvent(e){if("change"===e.type){e.originalSource??="BindableObject.handleEvent[change]";for(var{elem:t,prop:n}of this.elements){var r;e.target.name===n&&"BindableObject.updateDomElement"!==e.originalSource&&(r=e.target.type.includes("select")?{id:e.target.value,text:e.target.options[e.target.selectedIndex].textContent}:e.target.value,this.change(r,e,n))}}}change(e,n,r){n.originalSource??="BindableObject.change",a7.log.trace("change : Source: "+n.originalSource);let t=this.processValue(e);if(r){if("object"!=typeof this.data||null===this.data)throw new Error("Attempt to treat a simple value as an object with properties.");if(!(r in this.data))throw new Error(`Property '${r}' of object is undefined.`);this.data[r]=t}else this.data=t;this.saveMemento(),this.elements.filter(({prop:e,elem:t})=>(!r||r===e)&&t!==n.target).forEach(({elem:e})=>this.updateDomElement(n,e,t))}updateDom(n,r,i){n.originalSource??="BindableObject.updateDom",this.elements.forEach(({elem:e,prop:t})=>{i?t===i&&this.updateDomElement(n,e,r):"object"==typeof r&&null!==r?t in r&&this.updateDomElement(n,e,r[t]):this.updateDomElement(n,e,r)})}updateDomElement(e,r,t){e.originalSource??="BindableObject.updateDomElement";var n=()=>{r.innerHTML="";var e=Array.isArray(t)?t:t instanceof Map?Array.from(t.entries()):[t];"SELECT"===r.tagName?e.forEach((e,t)=>{var n=document.createElement("option");n.value="object"==typeof e?e.id??e[0]:e,n.textContent="object"==typeof e?e.text??e[1]:e,r.appendChild(n)}):["UL","OL"].includes(r.tagName)&&e.forEach(e=>{var t=document.createElement("li");t.textContent="object"==typeof e?e.text??e[1]:e,r.appendChild(t)})},i=["INPUT","TEXTAREA"].includes(r.tagName),o=["OL","UL","SELECT"].includes(r.tagName),s=["DIV","SPAN","H1","H2","H3","H4","H5","H6","P","LABEL","BUTTON","A","STRONG","EM","B","I","U","SMALL","SUB","SUP","Q","BLOCKQUOTE","CITE","CODE","PRE","ABBR","DFN","SAMP","KBD","VAR","LI","DT","DD","TH","TD","CAPTION","FIGCAPTION","SUMMARY","LEGEND","TITLE"].includes(r.tagName);"object"==typeof t&&null!==t?i?r.value=t.id??(t instanceof Map?"":t[0])??"":o?n():s&&(r.textContent=t.text??(t instanceof Map?"":t[1])??""):i?r.value=t??"":o?n():s&&(r.textContent=t??""),"model.set"!==e.originalSource&&"memento.restore"!==e.originalSource&&r.dispatchEvent(new Event("change",{originalSource:"model.updateDomElement"}))}bind(e,t){var n={elem:e,prop:t||""};e.value=t?this.data[t]:this.data,e.addEventListener("change",this),this.elements.push(n)}processValue(e){switch(typeof e){case"undefined":case"number":case"boolean":case"function":case"symbol":case"string":return e;case"object":return null===e?null:e instanceof Map?new Map(e):e;default:return e}}saveMemento(){this.currentMementoIndex<this.mementos.length-1&&this.mementos.splice(this.currentMementoIndex+1);var e=this.processValue(this.data);this.mementos.push(e),this.mementos.length>t?this.mementos.shift():this.currentMementoIndex++}undo(){return 0<this.currentMementoIndex&&(this.currentMementoIndex--,this.restoreMemento(),!0)}redo(){return this.currentMementoIndex<this.mementos.length-1&&(this.currentMementoIndex++,this.restoreMemento(),!0)}rewind(){return 0<this.currentMementoIndex&&(this.currentMementoIndex=0,this.restoreMemento(),!0)}fastForward(){return this.currentMementoIndex<this.mementos.length-1&&(this.currentMementoIndex=this.mementos.length-1,this.restoreMemento(),!0)}restoreMemento(){this.data=this.processValue(this.mementos[this.currentMementoIndex]);let n={originalSource:"memento.restore"};this.elements.forEach(({elem:e,prop:t})=>{this.updateDomElement(n,e,t?this.data[t]:this.data)})}}return{BindableObject:i,init(e={}){t=e.maxMementos??20},create(e,t,n){t=new i(t).processValue(t),t=new i(t,n);s.set(e,t),r.set(e,t)},destroy(e){s.delete(e),r.delete(e)},bind(e,t){var[e,n]=e.split("."),e=s.get(e);e&&e.bind(t,n)},exists(e){return s.has(e)},get(e,t){if(e){var[e,n]=e.split("."),r=s.get(e);if(r){if(!t)return(n=n?r.data[n]:r.data)instanceof Map?new Map(n):n;if(r.data instanceof Map){if(r.data.has(t))return r.data.get(t);a7.log.error(`Key '${t}' does not exist in the Map .`)}}else a7.log.error(`Key '${e}' does not exist in the model.`)}else a7.log.error("Expected parameter [name] is not defined.")},set(e,t){if(e){var[e,n]=e.split("."),r={originalSource:"model.set"};if(s.has(e)){var i=s.get(e),o=i.processValue(t);i.change(o,r,n),i.updateDom(r,o,n)}else{if(n)throw new Error(`Object ${e} is not yet initialized.`);this.create(e,t)}}else a7.log.error("Expected parameter [name] is not defined.")},undo(e){e=r.get(e);return!!e&&e.undo()},redo(e){e=r.get(e);return!!e&&e.redo()},rewind(e){e=r.get(e);return!!e&&e.rewind()},fastForward(e){e=r.get(e);return!!e&&e.fastForward()}}})();class o extends e{constructor(e){super(),this.id=e.id,this.key=e.key,this.remoteMethods=e.remoteMethods,this.entityClass=e.entityClass,this.dataProviders=new Map,this.bindings=new Map,this.queue=new Map,this.config(),this.fireEvent("mustRegister")}config(){var e=this.get();e&&e instanceof Map||this.set(new Map),this.on("mustRegister",()=>{a7.log.trace("mustRegister: Service: "+this.id),a7.services.register(this)})}registerDataProvider(e){this.dataProviders.set(e.id,e)}convertArrayToMap(e){let t=new Map;return e.forEach(e=>{e[this.key]&&t.set(e[this.key],e)}),t}convertMapToArray(e){return Array.from(e.values())}compareIDs(e){a7.log.trace("Service: "+this.id),a7.log.trace("compareIDs: "+e);let t=this.get(),n=[],r=[];return t instanceof Map?(e.forEach(e=>{(t.has(e)?n:r).push(e)}),a7.log.trace("results: "+JSON.stringify(n)+" "+JSON.stringify(r)),{present:n,missing:r}):{present:n,missing:e}}merge(e){let t=this.get();return t instanceof Map||(t=new Map),e.forEach(e=>{e[this.key]&&t.set(e[this.key],this.format(e))}),this.set(t),this.fireEvent("cacheChanged",{action:"refresh"}),t}bind(e,t){this.bindings.set(e,{filter:t})}async create(e){let t=!e instanceof this.entityClass?this.format(e):e;return await a7.remote.invoke(this.remoteMethods.create,t).then(e=>e.json()).then(e=>{t=this.format(e),this.cacheSet(t)}),t}async read(e){let n=this.get();var r=this.remoteMethods.read+"-"+JSON.stringify(e);if(this.queue.has(r))a7.log.trace("Duplicate read request detected, cancelling new request");else if(!n.has(e[this.key])){let t;await a7.remote.invoke(this.remoteMethods.read,e).then(e=>e.json()).then(e=>{t=e}),this.cacheSet(this.format(t)),this.queue.delete(r),n=this.get()}return n.get(e[this.key])}async update(e){let t=this.format(e);return await a7.remote.invoke(this.remoteMethods.update,e).then(e=>e.json()).then(e=>{t=this.format(e),this.cacheSet(t)}),t}async delete(e){return await a7.remote.invoke(this.remoteMethods.delete,e).then(e=>e.json()).then(e=>{}),this.cacheDelete(e[this.key]),!0}async readAll(e){var n=this.remoteMethods.readAll+"-"+JSON.stringify(e);if(this.queue.has(n))a7.log.trace("Duplicate read request detected, cancelling new request");else if(!this.get().size){let t;await a7.remote.invoke(this.remoteMethods.readAll,e).then(e=>e.json()).then(e=>{t=e}),this.merge(t),this.queue.delete(n)}return this.get()}format(e){return new this.entityClass(e)}cacheDelete(e){var t=this.get();t.delete(e),this.set(t),this.fireEvent("cacheChanged",{action:"delete"})}cacheSet(e){if(!(e instanceof this.entityClass))throw"Item must be of proper entity type.";var t=this.get();t.set(e[this.key],e),this.set(t),this.fireEvent("cacheChanged",{action:"refresh"})}set(e){a7.model.set(this.id,e)}get(e){return void 0===e?a7.model.get(this.id):a7.model.get(this.id,e)}async readMany(e){if(void 0===e)return new Map;a7.log.trace("readMany: ");let t=this.remoteMethods.readMany+"-"+JSON.stringify(e);var n,r;return this.queue.has(t)?a7.log.trace("Duplicate read request detected, cancelling new request"):({present:n,missing:r}=this.compareIDs(e),a7.log.trace("Missing? "+r.length),0<r.length&&await a7.remote.invoke(this.remoteMethods.readMany,{id:r}).then(e=>e.json()).then(e=>{Array.isArray(e)&&(this.merge(e),this.queue.delete(t))})),e.map(e=>this.get(e)||null).filter(e=>null!==e)}sort(e,s){e=e instanceof Map?Array.from(e.values()):e;if(s&&"object"==typeof s&&0!==Object.keys(s).length)return e.sort((e,t)=>{for(var n of Object.keys(s)){var r=s[n]||"asc",i=e[n],o=t[n];if(void 0!==i&&void 0!==o){if(typeof i!=typeof o)throw new Error(`Inconsistent types for sorting field '${n}'`);if("string"==typeof i)return n=i.localeCompare(o),"asc"===r?n:-n;if(i<o)return"asc"===r?-1:1;if(o<i)return"asc"===r?1:-1}}return 0}),e;throw new Error("Invalid sort fields provided")}filter(e,a){e=Array.isArray(e)?e:Array.from(e.values());if(!a||"object"!=typeof a||0===Object.keys(a).length)throw new Error("Invalid filter criteria provided");let c=(e,t,n)=>{switch(n){case"=":return e===t;case"!=":return e!==t;case">":return t<e;case"<":return e<t;case">=":return t<=e;case"<=":return e<=t;case"∈":case"in":return Array.isArray(t)&&t.includes(e);case"∉":case"not in":return Array.isArray(t)&&!t.includes(e);default:throw new Error("Invalid operator: "+n)}};return e.filter(e=>{for(var t of Object.keys(a)){var n,r,i,o,s=a[t];if(Array.isArray(s)&&3===s.length)return[n,r,i]=s,o=e[t],r="function"==typeof r?r():r,i&&"string"==typeof r?(i=new RegExp(r),c(o.toString(),i.test(o),n)):c(o,r,n);if(Array.isArray(s)&&2===s.length)return i=s[0],"object"==typeof(o="function"==typeof s[1]?s[1]():s[1])&&Array.isArray(o)?((e,t)=>{if(Array.isArray(t)&&2===t.length)return e>=t[0]&&e<=t[1];throw new Error("Range must be an array with two elements")})(e[t],o):c(e[t],o,i);throw new Error("Invalid criterion for field: "+t)}return!0})}}class s extends e{constructor(e){super(),Object.assign(this,e)}getMemento(){let t={},n=this;return Object.keys(this).forEach(e=>{t[e]=n[e]}),t}}class a extends e{constructor(e){super(),this.renderer=a7.model.get("a7").ui.renderer,this.type="View",this.timeout,this.timer,this.element,this.props=e,this.isTransient=e.isTransient||!1,this.state={},this.skipRender=!1,this.children={},this.components={},this.config(),this.fireEvent("mustRegister")}config(){this.on("mustRegister",function(){a7.log.trace("mustRegister: "+this.props.id),a7.ui.register(this),a7.ui.getView(this.props.parentID)&&a7.ui.getView(this.props.parentID).addChild(this)}.bind(this)),this.on("mustRender",a7.util.debounce(function(){a7.log.trace("mustRender: "+this.props.id),this.shouldRender()?a7.ui.enqueueForRender(this.props.id):(a7.log.trace("Render cancelled: "+this.props.id),this.skipRender=!1)}.bind(this)),a7.model.get("a7").ui.debounceTime,!0),this.on("rendered",function(){this.isTransient&&(void 0!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.checkRenderStatus.bind(this),a7.model.get("a7").ui.timeout)),this.onRendered()}.bind(this)),this.on("registered",function(){void 0!==this.props.parentID&&!this.mustRender||this.fireEvent("mustRender")}.bind(this)),this.on("mustUnregister",function(){a7.ui.unregister(this.props.id)}.bind(this))}setState(e){this.dataProvider?this.dataProvider.setState(e):(this.state=Object.assign(e),this.fireEvent("stateChanged",e)),this.fireEvent("mustRender")}getState(){return this.dataProvider?this.dataProvider.getState():Object.assign(this.state)}registerDataProvider(e){this.dataProvider=e,this.dataProvider.on("stateChanged",(e,t)=>{this.fireEvent("stateChanged",t)})}unregisterDataProvider(){this.dataProvider=null}addChild(e){this.children[e.props.id]=e}removeChild(e){delete this.children[e.props.id]}clearChildren(){this.children={}}getParent(){return this.props.parentID?a7.ui.getView(this.props.parentID):void 0}render(){var t;a7.log.trace("render: "+this.props.id),null==this.element&&(this.element=document.querySelector(this.props.selector)),this.element?(this.element.innerHTML="function"==typeof this.template?this.template():this.template,t=[],a7.ui.getEvents().forEach(function(e){t.push("[data-on"+e+"]")}),this.element.querySelectorAll(t.toString()).forEach(function(e){for(var t=0;t<e.attributes.length;t++){var n=e.attributes[t];n.name.startsWith("data-on")&&(n=n.name.substring(7,n.name.length),e.addEventListener(n,this.eventHandlers[e.attributes["data-on"+n].value]))}}.bind(this)),this.element.querySelectorAll("[data-bind]").forEach(function(e){a7.model.bind(e.attributes["data-bind"].value,e)}),this.fireEvent("rendered")):(a7.log.error("The DOM element for view "+this.props.id+" was not found. The view will be removed and unregistered."),void 0!==this.props.parentID&&a7.ui.getView(this.props.parentID).removeChild(this),this.fireEvent("mustUnregister"))}shouldRender(){return!this.skipRender}onRendered(){for(var e in this.children)this.children[e].element=document.querySelector(this.children[e].props.selector),this.children[e].render()}checkRenderStatus(){null===document.querySelector(this.props.selector)?a7.ui.unregister(this.id):this.isTransient&&(this.timer=setTimeout(this.checkRenderStatus.bind(this),a7.model.get("a7").ui.timeout))}}return{Component:e,Constructor:function(t,e,n){var r;return!0===n&&i.getAll().forEach(function(e){void 0===t.prototype[e]&&(t.prototype[e.name]=e.func)}),r=Object.create(t.prototype),!0===n&&(r.events={},void 0!==t.prototype.events)&&t.prototype.events.forEach(function(e){r.events[e]=[]}),n=void 0===(n=t.apply(r,e))?r:n},DataProvider:t,Entity:n,EventBindings:i,Model:r,Service:o,User:s,View:a}})(),a7.remote=(()=>{function n(e,t){r[e]=t}function o(){new Promise(function(e,t){a7.remote.invoke("auth.refresh",{resolve:e,reject:t})}).then(function(e){e.authenticated&&a7.log.trace("Still logged in.")}).catch(function(e){a7.events.publish("auth.sessionTimeout")})}function s(e){sessionStorage.token=e,a=e}var a,c,u={},l=new Date,r={};return{webSocket:function(t,n,r){if(t){if(window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket){let e=new WebSocket(t);return e.onopen=function(){a7.log.info("Connecting to the socket server at "+t)},e.onerror=function(){a7.log.error("Can't connect to the socket server at "+t)},e.onmessage=function(t){if(r){var e;try{e=JSON.parse(t.data)}catch(e){return void a7.log.error("This doesn't look like valid JSON: ",t.data)}n(t,e)}else n(t)},window.addEventListener("close",function(){e.close()}),e}a7.log.error("Your browser doesn't support WebSockets.")}},getToken:function(){return a},invalidateToken:function(){s("")},getSessionTimer:function(){return c},refreshClientSession:o,init:function(t){var e=a7.model.get("a7").auth;(u=a7.model.get("a7").remote).sessionTimeout=e.sessionTimeout,u.useTokens&&sessionStorage.token&&""!==sessionStorage.token&&(a=sessionStorage.token),n("auth",{login:function(e){a7.log.trace("remote call: auth.login");var t={method:"POST",headers:{Authorization:"Basic "+a7.util.base64.encode64(e.username+":"+e.password),Accept:"application/json, application/xml, text/play, text/html, *.*","Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({rememberMe:e.rememberMe||!1})},t=new Request(u.loginURL,t);fetch(t).then(function(e){var t="X-Token"===u.tokenType?e.headers.get("X-Token"):e.headers.get("Access_token");return null!=t&&s(t),e.json()}).then(function(t){var n;t.success?(n=a7.model.get("user"),Object.keys(t.user).map(function(e){n[e]=t.user[e]}),sessionStorage.user=JSON.stringify(n),a7.model.set("user",n),void 0!==e.success&&("function"==typeof e.success?e.success(t):a7.model.get("a7").router?a7.router.open(e.success,t):a7.events.publish(e.success,t))):void 0!==e.failure&&("function"==typeof e.failure?e.failure(t):a7.model.get("a7").router?a7.router.open(e.failure,t):a7.events.publish(e.failure,t)),void 0!==e.callback&&e.callback(t)})},logout:function(t){a7.log.trace("remote call: auth.logout");var e={method:"POST",headers:{Authorization:"Basic "+a7.util.base64.encode64(t.username+":"+t.password)}},e=new Request(u.logoutURL,e);fetch(e).then(function(e){return e.json()}).then(function(e){e.success?(a7.security.invalidateSession(),void 0!==t.success&&("function"==typeof t.success?t.success(e):a7.model.get("a7").router?a7.router.open(t.success,e):a7.events.publish(t.success,e))):void 0!==t.failure&&("function"==typeof t.failure?t.failure(e):a7.model.get("a7").router?a7.router.open(t.failure,e):a7.events.publish(t.failure,e)),void 0!==t.callback&&t.callback()})},refresh:function(t){a7.remote.fetch(u.refreshURL,{},!0).then(function(e){return 401===e.status?{isauthenticated:!1}:e.json()}).then(function(e){void 0!==t.resolve&&t.resolve(e)}).catch(function(e){t.reject&&t.reject(e)})}}),Object.keys(t).forEach(function(e){n(e,t[e])})},fetch:function(e,t,n){if(a7.log.info("fetch: "+e),n&&u.useTokens){var r=new Date,i=Math.abs(r-l);if(Math.floor(i/1e3/60)>u.sessionTimeout)return void a7.events.publish("auth.sessionTimeout");null!=a&&(void 0===t.headers?"X-Token"===u.tokenType?t.headers={"X-Token":a}:t.headers={Authorization:"Bearer "+a7.remote.getToken()}:"X-Token"===u.tokenType?t.headers["X-Token"]=a:t.headers.Authorization="Bearer "+a7.remote.getToken()),l=r}return i=new Request(e,t),(r=fetch(i)).then(function(e){n&&u.useTokens&&(null!=(e="X-Token"===u.tokenType?e.headers.get("X-Token"):e.headers.get("Access_token"))?(s(e),void 0!==c&&clearTimeout(c),c=setTimeout(o,u.sessionTimeout)):a7.events.publish("auth.sessionTimeout"))}).catch(function(e){a7.log.error(e)}),r},invoke:function(e,t){e=e.split(".");if(!(e.length<2))return"function"==typeof r[e[0]][e[1]]?r[e[0]][e[1]](t):void 0;a7.log.error("No action specified. Valid actions are: "+Object.keys(r[e[0]]).toString())}}})(),a7.router=(()=>{var o=/^[^/]+/,s=/^(:\w|\()/,i=/:\w|\(/,a=/^(?::(\w+))?(?:\(([^)]+)\))?/;function n(e){var t=this;this.root=this._createNode(),e&&e.forEach(function(e){return t.add.apply(t,e)})}var c,u,e=n.prototype;function l(e){return u.find(e)}function r(e,t={}){var n=u.find(e),r=Object.assign(t||{},n.params||{});history.pushState(JSON.parse(JSON.stringify(t)),"",e),c.useEvents?a7.events.publish(n.handler,r):n.handler(r)}return e._createNode=function(e){e=void 0===e?{}:e;return{regex:e.regex,param:e.param,handler:e.handler,children:{string:{},regex:{}}}},e.add=function(e,t){return this._parseOptim(e,t,this.root),this},e._parse=function(e,t,n){var r,i;s.test(e)?(r=e.match(a),i=(i=n.children.regex[r[0]])||(n.children.regex[r[0]]=this._createNode({regex:r[2]?new RegExp("^"+r[2]):o,param:r[1]})),r[0].length===e.length?i.handler=t:this._parseOptim(e.slice(r[0].length),t,i)):(r=e[0],i=(i=n.children.string[r])||(n.children.string[r]=this._createNode()),this._parse(e.slice(1),t,i))},e._parseOptim=function(e,t,n){var r;i.test(e)?this._parse(e,t,n):(r=n.children.string[e])?r.handler=t:n.children.string[e]=this._createNode({handler:t})},e.find=function(e){return this._findOptim(e,this.root,{})},e._findOptim=function(e,t,n){var r=t.children.string[e];return r&&void 0!==r.handler?{handler:r.handler,params:n}:this._find(e,t,n)},e._find=function(e,t,n){if(o=t.children.string[e[0]]){var r=this._find(e.slice(1),o,n);if(r)return r}for(var i in t.children.regex){var o=t.children.regex[i],i=e.match(o.regex);if(i){if(i[0].length===e.length&&void 0!==o.handler)return o.param&&(n[o.param]=decodeURIComponent(i[0])),{handler:o.handler,params:n};var s=this._findOptim(e.slice(i[0].length),o,n);if(s)return o.param&&(n[o.param]=decodeURIComponent(i[0])),s}}return null},{open:function(e,t={}){var n=l(e),r=n.handler,e=(history.pushState(JSON.parse(JSON.stringify(t)),"",e),Object.assign(t||{},n.params||{}));c.useEvents&&"string"==typeof r?a7.events.publish(r,e):r(e)},add:function(e,t){u.add(e,t)},find:l,match:r,init:function(e,t){u=new n(t),(c=e).useEvents=!!c.useEvents,window.onpopstate=function(e){r(document.location.pathname+document.location.search)}}}})(),a7.security=(()=>{let r=[],i=!1;function o(e){i&&a7.model.set("user",e),sessionStorage.user=JSON.stringify(e)}function n(){let t,n;var e=i?a7.model.get("user"):null;return void 0!==e&&""!==e&&null!==e?n=e:sessionStorage.user&&""!==sessionStorage.user&&(t=JSON.parse(sessionStorage.user),n=new a7.components.User(r),Object.keys(t).map(function(e){n[e]=t[e]})),n}return{invalidateSession:function(){clearTimeout(a7.remote.getSessionTimer()),a7.remote.invalidateToken();var e=new a7.components.User(r);o(e)},isAuthenticated:async function(e,t){a7.log.info("Checking authenticated state.. ");var n=await new Promise((e,t)=>{a7.remote.invoke("auth.refresh",{resolve:e,reject:t})});n.authenticated&&o(n.user),e(n)},setUser:o,getUser:n,init:function(e){a7.log.info("Security initializing...");var t=e.security.options,e=(e.model.length,r=t.userArgs||[],n(r));o(e)}}})(),a7.services=(()=>{let t=new Map;return{init:function(e){for(var t in e.services)a7.services.register(t)},getService:function(e){return t.get(e)},getAll:function(){return t},register:function(e){t.set(e.id,e)}}})(),a7.ui=(()=>{function r(e){a7.log.trace("Find parents of "+e);var t=[];let n=d[e];for(;void 0!==n.props.parentID;)t.unshift(n.props.parentID),n=d[n.props.parentID];return t}function i(){a7.log.trace("processing the queue"),e(!0);try{u.forEach(function(e){d[e].render()})}catch(e){a7.log.trace(e)}u=[],e(!1),l.forEach(function(e){t(e)}),l=[]}let n=["cached","error","abort","load","beforeunload"].concat(["online","offline"]).concat(["focus","blur"]).concat(["open","message","error","close"]).concat(["pagehide","pageshow","popstate"]).concat(["animationstart","animationend","animationiteration"]).concat(["transitionstart","transitioncancel","transitionend","transitionrun"]).concat(["reset","submit"]).concat(["beforeprint","afterprint"]).concat(["compositionstart","compositionupdate","compositionend"]).concat(["fullscreenchange","fullscreenerror","resize","scroll"]).concat(["cut","copy","paste"]).concat(["keydown","keypress","keyup"]).concat(["auxclick","click","contextmenu","dblclick","mousedown","mousenter","mouseleave","mousemove","mouseover","mouseout","mouseup","pointerlockchange","pointerlockerror","wheel"]).concat(["drag","dragend","dragstart","dragleave","dragover","drop"]).concat(["audioprocess","canplay","canplaythrough","complete","durationchange","emptied","ended","loadeddata","loadedmetadata","pause","play","playing","ratechange","seeked","seeking","stalled","suspend","timeupdate","columechange","waiting"]).concat(["loadend","loadstart","progress","timeout"]).concat(["change","storage"]).concat(["checking","downloading","noupdate","obsolete","updateready"]).concat(["broadcast","CheckBoxStateChange","hashchange","input","RadioStateChange","readystatechange","ValueChange"]).concat(["invalid","localized","show"]),o=[],s={},a={},c={},u=[],l=[],h=!1,d=[],f=function(e){return d[e]},e=function(e){h=e,a7.log.trace("a7.ui.stateTransition: "+e)},g=function(e){a7.log.trace("Find children of "+e);var t,n=[],r=d[e];for(t in r.children){var i=r.children[t].props.id;void 0!==f(i)&&(n.push(i),n.concat(g(i)))}return n},t=function(t){if(h)l.push(t);else if(a7.log.trace("enqueue: "+t),u.length){var e=g(t);if(void 0===d[t].props.parentID)a7.log.trace("add to front of queue: "+t),u.unshift(t);else{var n=r(t);let e=void 0;void 0===(e=n.length?n.find(function(e){return 0<=u.indexOf(e)}):e)&&(a7.log.trace("add to end of queue: "+t),u.push(t))}e.forEach(function(e){0<=u.indexOf(e)&&(a7.log.trace("remove child from queue: "+e),u.splice(u.indexOf(e),1))})}else a7.log.trace("add first view to queue: "+t),u.push(t),i()};return{getEvents:function(){return o},selectors:a,getSelector:function(e){return a[e]},setSelector:function(e,t){a[e]=t,c[e]=document.querySelector(t)},getNode:function(e){return c[e]},register:function(e){switch(s.renderer){case"Handlebars":case"Mustache":case"templateLiterals":(d[e.props.id]=e).fireEvent("registered")}},unregister:function(e){delete d[e]},getView:f,enqueueForRender:t,removeView:function(e){delete d[e]},views:d,init:function(e,t){switch(a7.log.trace("Layout initializing..."),(s=a7.model.get("a7").ui).eventGroups||"standard"){case"extended":t("Extended events are not implemented yet.");case"standard":o=n;break;default:s.eventGroups.forEach(function(e){o=o.concat(e)})}e()}}})(),a7.util={split:function(e){return e.split(/,\s*/)},extractLast:function(e){return this.split(e).pop()},base64:{keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(e){if(!String(e).length)return!1;for(var t,n,r,i,o,s,a="",c=0;r=(t=e.charCodeAt(c++))>>2,i=(3&t)<<4|(t=e.charCodeAt(c++))>>4,o=(15&t)<<2|(n=e.charCodeAt(c++))>>6,s=63&n,isNaN(t)?o=s=64:isNaN(n)&&(s=64),a=a+this.keyStr.charAt(r)+this.keyStr.charAt(i)+this.keyStr.charAt(o)+this.keyStr.charAt(s),c<e.length;);return a},decode64:function(e){if(!e)return!1;var t,n,r,i,o,s,a="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");r=this.keyStr.indexOf(e.charAt(c++)),t=(15&(i=this.keyStr.indexOf(e.charAt(c++))))<<4|(o=this.keyStr.indexOf(e.charAt(c++)))>>2,n=(3&o)<<6|(s=this.keyStr.indexOf(e.charAt(c++))),a+=String.fromCharCode(r<<2|i>>4),64!==o&&(a+=String.fromCharCode(t)),64!==s&&(a+=String.fromCharCode(n)),c<e.length;);return a}},leadingZero:function(e){return e<10?"0"+e:e},dynamicSort:function(n){var r=1;return"-"===n[0]&&(r=-1,n=n.substr(1)),function(e,t){return(e[n]<t[n]?-1:e[n]>t[n]?1:0)*r}},yesNo:function(e){return parseInt(e,10)<1?"No":"Yes"},isValidDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},id:function(){return((100*Math.random()).toString()+(100*Math.random()).toString()).replace(/\./g,"")},tryCatch:function(e,t,n){var r={value:null};try{return e.apply(t,n)}catch(e){return r.value=e,r}},getNumberValue:function(e){return isNaN(Number(e))?Number(e.substring(0,e.length-2)):e},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getOffset:function(e){e=e.getBoundingClientRect();return{top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft}},debounce:function(r,i,o=!1){let s;return function(){let e=this,t=arguments;var n=o&&!s;clearTimeout(s),s=setTimeout(function(){s=null,o||r.apply(e,t)},i),n&&r.apply(e,t)}}};export{a7};
//# sourceMappingURL=a7.min.js.map